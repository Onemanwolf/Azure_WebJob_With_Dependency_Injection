<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      autoReload="true"
      internalLogLevel="Info"
      throwConfigExceptions="true"
      internalLogFile="c:\temp\internal-nlog.txt">

  <!-- enable asp.net core layout renderers -->
  <extensions>
    <add assembly="NLog.Web.AspNetCore"/>
    <add assembly="NLog.Extensions.AzureBlobStorage" />
    <add assembly="NLog.Extensions.AzureEventHub" />
 
  </extensions>

  <!-- the targets to write to -->
  <targets>
    <target xsi:type="AzureBlobStorage"
          name="AzureBlob"
          layout="${longdate:universalTime=true} ${level:uppercase=true} - ${logger}: ${message} ${exception:format=tostring}"
          blobName="level"
          connectionString="Endpoint=sb://paycheck-eventhub-demo-ehub.servicebus.windows.net/;SharedAccessKeyName=NlogPolicy;SharedAccessKey=a1UFYTAifL167D/Xa8fXPonhcWioA4bIYzBkiUcbPn0=;EntityPath=nloghub"
          connectionStringKey="8o8r3EYWsEBjHv0aWt4XgZb+rxFh2FIIlwMnk+SdGSE="
          container="level" />
    <target type="AzureBlobStorage"
            name="AzureEmulator"
            layout="${longdate:universalTime=true} ${level:uppercase=true} - ${logger}: ${message} ${exception:format=tostring}"
            connectionString="Endpoint=sb://paycheck-eventhub-demo-ehub.servicebus.windows.net/;SharedAccessKeyName=NlogPolicy;SharedAccessKey=a1UFYTAifL167D/Xa8fXPonhcWioA4bIYzBkiUcbPn0=;EntityPath=nloghub"
            container="level"
            blobName="levelLogs" />
    <target type="AzureBlobStorage"
            name="Azure"
            layout="${longdate:universalTime=true} ${level:uppercase=true} - ${logger}: ${message} ${exception:format=tostring}"
            connectionStringKey="DefaultEndpointsProtocol=https;AccountName=eventhubapphostgroupdiag;AccountKey=bV0JPhbH/e2+PD0WOnDYnLeNV07eHaX+3nhhlzxuS2NrR9KKBMDeiSWGSAccjFEFRRn8keB/SD06l2KMx1a40w==;EndpointSuffix=core.windows.net"
            container="machinename"
            blobName="machine" />

    <target xsi:type="AzureEventHub"
          name="String"
          layout="Layout"
          eventHubName="nloghub"
          partitionKey="1"
          contentType="Layout"
          connectionString="${gdc:item=AzureEventHubConnectionString}">
      <contextProperty name="level" layout="${level}" />
      <contextProperty name="exception" layout="${exception:format=shorttype}" includeEmptyValue="false" />
      <layout type="JsonLayout" includeAllProperties="true">
        <attribute name="time" layout="${longdate}" />
        <attribute name="message" layout="${message}" />
        <attribute name="threadid" layout="${threadid}" />
        <attribute name="exception" layout="${exception:format=tostring}" />
      </layout>

     
    
    </target>

    <target name="logfile" xsi:type="File" fileName="c:\temp\nlog.txt" />
    <target name="logconsole" xsi:type="Console" />
    
    <!-- write logs to file  -->
 
    
  </targets>

  <!-- rules to map from logger name to target -->
  <rules>
    <!--All logs, including from Microsoft-->
    <logger name="*" minlevel="Trace" writeTo="logfile" />

    <!--Skip non-critical Microsoft logs and so log only own logs-->
    <logger name="Microsoft.*" maxlevel="Info" final="true" />
    <!-- BlackHole without writeTo -->
    <logger name="*" minlevel="Trace" writeTo="String, AzureBlob" />
  </rules>
</nlog>